
<!doctype html>
<html>
    <head>
      <title>Kova Bar Chart</title>
      <link rel="stylesheet" href="style.css">
      <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
      <script src="functions.js"></script>
    </head>
    <body>

      <div id="content">
        <main>
          <h2 id="chart-title">Bar Chart</h2>
          <!--This is where the bar chart will be-->
          <div id="bar-container">
            <div class="bar"><p class="bar-label bar-label-top">100</p></div>
            <div class="bar"><p class="bar-label bar-label-middle">70</p></div>
            <div class="bar"><p class="bar-label bar-label-bottom">20</p></div>
            <div class="bar"><p class="bar-label">90</p></div>
            <div class="bar"><p class="bar-label">90</p></div>
            <div class="bar"><p class="bar-label">45</p></div>
          </div>
        </main>
        <form id="settings-form">
          <!--This is where all the settings for the bar chart will be located-->
          <label>Bar Chart Title:</label>
          <input autocomplete="off" type="text" maxlength="20" oninput="updateChartOptions('chartTitle', value)" value="Bar Chart">
          <br><br>
          <label>Bar Chart Font Size:</label>
          <input autocomplete="off" type="number" maxlength="2" min="14" max="72" oninput="updateChartOptions('titleSize', value)" value="26">
          <br><br>
          <label>Title colour:</label>
          <select autocomplete="off" class="colour-picker" onchange="updateChartOptions('titleColour', this.value)">
            <option class="colour-choice" value="pink">Red</option>
            <option class="colour-choice" value="palegreen">Green</option>
            <option class="colour-choice" value="lightskyblue">Blue</option>
            <option class="colour-choice" value="khaki">Yellow</option>
          </select>
          <br><br>
          <table>
            <tr>
              <th><label>X-Axis Label:</label></th>
              <th><label>Y-Axis Label:</label></th>
            </tr>
            <tr>
              <td><input autocomplete="off" type="text" maxlength="20" oninput="updateChartOptions('axisLabelX', value)" value="X Axis"></td>
              <td><input autocomplete="off" type="text" maxlength="20" oninput="updateChartOptions('axisLabelY', value)" value="Y Axis"></td>
            </tr>
          </table>
          <br>
          <label>Label colour:</label>
          <select autocomplete="off" class="colour-picker" onchange="updateChartOptions('labelColour', this.value)">
            <option class="colour-choice" value="maroon">Red</option>
            <option class="colour-choice" value="darkslategray">Green</option>
            <option class="colour-choice" value="navy">Blue</option>
            <option class="colour-choice" value="saddlebrown">Yellow</option>
          </select>
          <br><br><hr><br>
          <label>Number of graph elements:</label>
          <input autocomplete="off" type="number" maxlength="2" min="2" max="20" id="number-of-elements" oninput="updateNumberOfElements(value)" value="3"><br>
          <br>
          <input autocomplete="off" checked type="checkbox" id="show-labels-choice" oninput="updateChartOptions('barLabels', checked);updateDataInputFields()">
          <label>Individual bar labels</label>
          <br>
          <table id="data-form"></table>
          <br><hr><br>
          <label>Show numerical values in bars:</label>
          <select autocomplete="off" onchange="updateChartOptions('valuePosition', valuePositions[this.value])">
            <option value="2">Top</option>
            <option value="1">Middle</option>
            <option value="0">Bottom</option>
            <option value="3">Do not show</option>
          </select>
          <br><br>
          <label>Bar to space ratio (percentage):</label>
          <input autocomplete="off" type="number" maxlength="3" min="10" max="100" oninput="updateChartOptions('spacing', value)" value="50">
          <br><br>
          <label>Graph colour:</label>
          <select autocomplete="off" class="colour-picker" onchange="updateChartOptions('barColour', this.value)">
            <option class="colour-choice" value="salmon">Red</option>
            <option class="colour-choice" value="mediumseagreen">Green</option>
            <option class="colour-choice" value="cornflowerblue">Blue</option>
            <option class="colour-choice" value="gold">Yellow</option>
          </select>
          <br><br>
          <label>Subdivisions:</label>
          <input autocomplete="off" type="number" maxlength="1" min="0" max="5" oninput="updateChartOptions('numOfTicks', (parseInt(value) + parseInt(value) - 1))" value="3">
          <br><br><hr><br>
          <input type="button" id="generate-chart-button" value="Generate Chart">
        </form>
      </div>
      <footer class="footer">
        Created by Eric (Valeriy) Kovalevskyy in February of 2023 for Lighthouse Labs Prep Module.
      </footer>

      <script type="text/javascript">

        $("#generate-chart-button").click(function(){
          $("main").css("display", "initial");
          drawBarChart(barChartData, barSettings, barElement);
        });

        let chartDisplay = false;
        $("main").css("display", "none");

        let numOfElements = 3;
        let barChartData = [33, 50, 80];
        let barChartLabel = ["Data", "Data", "Data"];

        const valuePositions = ["bar-value-bottom", "bar-value-middle", "bar-value-top", "none"];

        let labelColour = "white";

        let barSettings = {
          valuePosition: valuePositions[2],
          barColour: "salmon",
          labelColour: "maroon",
          titleColour: "pink",
          titleSize: 20,
          spacing: 50,
          chartTitle: "Bar Chart",
          axisLabelX: "X Axis",
          axisLabelY: "Y Axis",
          numOfTicks: 3,
          barLabels: true,
          scaleData: false, //Whether the data should be shown from 0, or from the lowest point
        }

        const barElement = document.getElementById("bar-container");

        function drawBarChart(data, options, element){

          const size = []; //Get size of the container to determine the size of the bars

          const offset = 100;
          size[0] = $("#bar-container").width() - offset;
          size[1] = $("#bar-container").height();

          const bottomOffset = parseInt($("#bar-container").css("padding-bottom"), 10);
          const spacing = 1 - Math.floor(options.spacing) * 0.01;
          const barArea = Math.floor(size[0] / numOfElements);
          const spaceSize = Math.floor(barArea * spacing);
          const barSize = barArea - spaceSize;

          const startLocation = offset + barSize * spacing;
          const maxPercentage = 100 - (bottomOffset / size[1] * 100); //Maximum percentage of bar size relative to the container size

          let lowestDataNum = data[0];
          let highestDataNum = data[0];

          function getRange(){ //go through data to determine range
            for(let i = 0; i < data.length; i++){
              let entry = parseFloat(data[i]);
              if(isNaN(entry)){
                data[i] = "Invalid Data";
                lowestDataNum = 0;
                highestDataNum = 0;
              } else {
                if(entry < lowestDataNum){
                  lowestDataNum = data[i];
                }
                if(entry > highestDataNum){
                  highestDataNum = data[i];
                }
              }
            }
          }
          getRange();

          function createChartHTML(){
            //update title
            $("#chart-title").html(options.chartTitle);

            //Separating output into multiple strings on separate linesfor readability
            let output = `<h3 id="y-axis-label" class="axis-label">${options.axisLabelY}</h3>` +
            `<h4 class="scale-number" style="top: 0 margin-top: 10px">${highestDataNum}</h4>` +
            `<h4 class="scale-number" style="top: 280px">${highestDataNum * 0.5}</h4>` +
            `<h4 class="scale-number" style="top: 540px">0</h4>` +
            `<div id="data-scale">`;

            console.log(options.numOfTicks);

            for(let i = 0; i < options.numOfTicks; i++){
              output += `<hr>`;
            }

            output += `</div>`;

            for(let i = 0; i < numOfElements; i++){
              const dataPercentage = Math.floor(data[i] / highestDataNum * maxPercentage);

              const barLocation = (startLocation + barArea * i).toString();
              const labelPositionY = size[1] + 30;

              output += `<div class="bar" style="height: ${dataPercentage}%; margin-left: ${barLocation}px; bottom: ${bottomOffset}px">`;
              if(options.valuePosition != valuePositions[3]){
                output += `<p class="bar-value ${options.valuePosition}">${data[i]}</p>`;
              }

              output += `</div>`;
              if(options.barLabels){
                output += `<div class="bar-label" style="margin-left: ${barLocation}px; top: ${labelPositionY}px">${barChartLabel[i]}</div>`;
              }
            }
            output += `<h3 id="x-axis-label" class="axis-label" style="margin-bottom: ${-(options.barLabels ? 80 : 40)}px;">${options.axisLabelX}</h3>`;
            element.innerHTML = output;
          }
          createChartHTML();

          function applyChartCSS(){
            $("#chart-title").css("color", options.titleColour);
            let titleBackgroundColour;
            switch(options.titleColour){
              case "pink":
                titleBackgroundColour = "maroon";
                break;
              case "palegreen":
                titleBackgroundColour = "darkslategray";
                break;
              case "lightskyblue":
                titleBackgroundColour = "navy";
                break;
              case "khaki":
                titleBackgroundColour = "saddlebrown";
                break;
              default:
                titleBackgroundColour = "indigo";
            }
            $("#chart-title").css("background-color", titleBackgroundColour);
            $("#chart-title").css("font-size", options.titleSize + "px");

            $(".axis-label").css("color", options.labelColour);
            $(".bar-label").width(barSize + "px");
            $(".bar").width(barSize + "px");
            $(".bar").css("background-color", options.barColour);
            let gap = Math.floor(parseInt($("#data-scale").css("height"), 10) / (parseInt(options.numOfTicks) + 1)) - 1.5;

            $("#data-scale hr").css("margin-top", gap + "px");
            //$(".bar-label").css("color", options.labelColour);
          }
          applyChartCSS();

          //$("main").css("display", "initial");
          window.scrollTo(0,0);
        }

        updateDataInputFields();

        function updateDataInputFields(){
          let output = `<tr>`
          output += barSettings.barLabels ? `<th>Data Label</th><th>Data Value</th></tr><tr>` : `<th>Data Value</th></tr><tr>`;

          for(let i = 0; i < numOfElements; i++){
            if(barSettings.barLabels){
              output += `<td><input type="text" maxlength="30" class="data-label-input" oninput="writeLabel(${i}, value)" value="${barChartLabel[i]}"></td>`;
            }
            output += `<td><input type="number" class="data-value-input" oninput="writeData(${i}, value)" value="${barChartData[i]}"></td></tr>`;
          }

          $("#data-form").html(output);
        }

        function updateNumberOfElements(val){
          val = Math.ceil(val);
            val = Math.max(val, 2);

            if(val > numOfElements){

            for(let i = 0; i < val; i++){
              if(barChartData[i] === undefined){
                barChartData[i] = 0;
              }
              if(barChartLabel[i] === undefined){
                barChartLabel[i] = "Data";
              }
            }
          }

          numOfElements = val;
          updateDataInputFields();

        };

        function updateChartOptions(property, value){
          barSettings[property] = value;
        }

        function writeLabel(index, value){
          barChartLabel[index] = value;
        }
        function writeData(index, value){
          barChartData[index] = value;
        }

      </script>
    </body>
</html>
